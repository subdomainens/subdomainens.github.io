<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SubdomainENS</title>
      <link rel="stylesheet" href="css/style.css">
</head>

<style>
.button {
    background-color: #2e5151; 
    border: none;
    color: white;
    padding: 10px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
}

.btn{
    background-color: #454f4f; 
    border: none;
    color: white;
    padding: 5px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
}

button {

    background: transparent;
    border: none !important;
    color: white;
    cursor: pointer;
}â€‹
</style>

<body>

<style>

input{
  font-size:15px;
  padding:8px 10px;
  margin:8px;
}
</style>

  <div id='browser'>
  <div id='browser-bar'>
    <div class='circles'></div>
    <div class='circles'></div>
    <div class='circles'></div>
    <p><b>SubdomainENS</b></p>
   <span class='arrow entypo-resize-full'></span>
  </div>
  <div id='content'>
    <div id='left'>
     

<div id="QRCode" class="tabcontent" style="display:none;">
      <div id='map'>

          <center><p><button  onclick="tabClose()">Scan QRCode</button></p></center>   
<p></p>

<center><span><button type="button" style="padding: 10px 32px;" class="button" id="point" onclick="scan()">Scan QR Code</button>
<button type="button" style="padding: 10px 32px;" class="button" id="point" onclick="stopScan()">Stop Scan</button></span></center>
<p></p>
  <div class="camera">
<center>   <video id="video" width="320" height="240">Video stream not available.</video></center>
  </div>
  <canvas id="canvas" style="display: none;" width="320" height="240"> 
  </canvas>

</div>
</div>


     <div id="sendETH" class="tabcontent" style="display:none;">
      <div id='map'>     
          <center><p><button  onclick="tabClose()">Send ETH</button></p></center>   
        <p></p>
<center><input type="text" id="ETHfrom" placeholder="From Address"></input></center>
 <center><input type="text" id="ETHto"  placeholder="To Address"> </input></center>
 <center><input type="text" id="ETHValue"   placeholder="Value"> </input></center>
    <center><button type="button" class="button" onclick="sendETH()" id="point">Send</button></center>

      </div>
     </div>


<div id="sellName" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Sell Subdomains</button></p></center>   
        <p></p>
<center><input type="text" id="seller" style="padding:4px 10px;" placeholder="Your ETH Address"></input></center>
 <center><input type="text" id="namesell"  style="padding:4px 10px;" placeholder="ENS Name"> </input></center>
 <center><input type="text" id="nameexpiry"   style="padding:4px 10px;"placeholder="Expiry"> </input></center>
 <center><input type="text" id="nameprice"   style="padding:4px 10px;"placeholder="Price"> </input></center>

    <center><span><button type="button" class="button" style="padding: 10px 32px;" onclick="list()" id="point">List</button>
    <button type="button" class="button" style="padding: 10px 32px;" onclick="sell()" id="point">Finalize</button></span></center>
      </div>
     </div>

 <div id="nameUnlist" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Unlist ENS Name</button></p></center>   
        <p></p>

<center><input type="text" id="origOwner" placeholder="Owner Address"></input></center>
<center><input type="text" id="unlistEName" placeholder="ENS Name"></input></center>
    <center><button type="button" class="button" onclick="unlist();"" id="point">Unlist</button></center>

      </div>
     </div>



<div id="buyName" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Buy Subdomains</button></p></center>   
        <p></p>
<center><input type="text" id="buyer" style="padding:4px 10px;" placeholder="Your ETH Address"></input></center>
 <center><input type="text" id="regbuyername"  style="padding:4px 10px;" placeholder="Registrar Name."> </input></center>
 <center><input type="text" id="buyername"  style="padding:4px 10px;" placeholder="Your ENS Name"> </input></center>
 <center><input type="text" id="buynameprice"   style="padding:4px 10px;"placeholder="Price"> </input></center>
  <center><button type="button" class="button" style="padding: 10px 32px;" onclick="buy()" id="point">Buy</button></span></center>
      </div>
     </div>

 <div id="nameInfo" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Name Information</button></p></center>   
        <p></p>
<div style="position: relative;top: 50%;transform: translateY(-80%);">
<center><input type="text" id="ename" placeholder="ENS Name"></input></center>
    <center><button type="button" class="button" onclick="check();openDiv(event, 'NameOwner');"" id="point">Search</button></center>
</div>
      </div>
     </div>

<div id="NameOwner" class="tabcontent" style="display:none;">
      <div id='map'>
<p></p>
<div>
<p style="font-size:20px!important;">Subdomains</p>
<p>Owner: <span class="owner"></span></p>
<p>Expiry: <span class="subexpiry"></span></p>
<p>For Sale: <span class="subavailability"></span></p>
<p>Price: <span class="subPrice"></span></p>
</div>
<p></p>
</div>
</div>

<div id="resolveName" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Resolve Name</button></p></center>   
        <p></p>
<center><input type="text" id="origETH" placeholder="From Address"></input></center>
 <center><input type="text" id="destETH"  placeholder="To Address"> </input></center>
 <center><input type="text" id="resENS"   placeholder="ENS Name"> </input></center>
    <center><button type="button" class="button" onclick="resolve()" id="point">Resolve</button></center>

      </div>
     </div>

 <div id="resCheck" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Resolver Check</button></p></center>   
        <p></p>
<div style="position: relative;top: 50%;transform: translateY(-80%);">
<center><input type="text" id="resCheckName" placeholder="ENS Name"></input></center>
    <center><button type="button" class="button" onclick="resCheck();openDiv(event, 'AddResolver');"" id="point">Check</button></center>
</div>
      </div>
     </div>

<div id="PrivKey" class="tabcontent" style="display:none;">
      <div id='map'>
          <center><p><button  onclick="tabClose()">Private Key Auth</button></p></center>   
        <p></p>
<div style="position: relative;top: 50%;transform: translateY(-80%);">
<center><input type="password" id="globPrivKey" placeholder="Private Key"></input></center>
    <center><button type="button" class="button" onclick="globalKeySub()" id="point">Authorize</button></center>
</div>
      </div>
     </div>


<div id="AddResolver" class="tabcontent" style="display:none;">
<div id='map'>
<p></p>
<div style="position: relative;top: 50%;transform: translateY(-80%);">
<center><p>ENS Name Points To: <span class="resPoint"></span></p></center>
</div>
</div>
</div>

<div class="tabcontent" style="display:none;">
</div>

<div class="topnav" id="myTopnav">
      <ul id='location-bar' style="padding: 10px 32px;">
        <li>
          <button  onclick="openDiv(event, 'sendETH')">Send ETH</button>
        </li>
        <li>
          <button  onclick="openDiv(event, 'sellName')">Sell Name</button>
        </li>
        <li>
          <button  onclick="openDiv(event, 'nameUnlist')">Unlist Name</button>
        </li>
        <li>
          <button  onclick="openDiv(event, 'buyName')">Buy Name</button>
        </li>
          <li>
          <button  onclick="openDiv(event, 'nameInfo')">Name Information</button>
        </li> 
        <li>
          <button  onclick="openDiv(event, 'resolveName')">Resolve Name</button>
        </li>
       <li>
          <button  onclick="openDiv(event, 'resCheck')">Resolver Check</button>
        </li>
      </ul>
    </div>

    </div>
    <div id='right'>
      <p>Connect</p>
      <form>
        <p>Authorize</p>
<button type="button" class="btn"  onclick="openDiv(event, 'QRCode')">Scan QR-Code</button>
<p></p>
<button type="button" class="btn"  onclick="openDiv(event, 'PrivKey')">Enter Private Key</button>
      </form>
      <p>Discord Invitation</p>
      <a href="https://discord.gg/Bda8vwH">Join</a>
    </div>
  </div>
</div>
<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdn.rawgit.com/simpleens/etherwallet/mercury/dist/js/etherwallet-master.js"></script>
 <script type="text/javascript" src="https://chriseth.github.io/qr-demo/qrcode-reader.min.js"></script>
<script>
function toWei(num){
  return num*1.0e18;
}
</script>
<script>
function tabClose(){
 tabcontent = document.getElementsByClassName("tabcontent");
 for (i = 0; i < tabcontent.length; i++) {
   tabcontent[i].style.display = "none";
  }
}
</script>
<script>
function openDiv(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>
<script>
$(function(){
  $('input').bind('input', function(){
    $(this).val(function(_, v){
      return v.replace(/\s+/g, '');
    });
  });
});
</script>
<script>
function timeConverter(UNIX_timestamp){
  var a = new Date(UNIX_timestamp * 1000);
  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var year = a.getFullYear();
  var month = months[a.getMonth()];
  var date = a.getDate();
  var hour = a.getHours();
  var min = a.getMinutes() < 10 ? '0' + a.getMinutes() : a.getMinutes();
  var sec = a.getSeconds() < 10 ? '0' + a.getSeconds() : a.getSeconds();
  var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec ;
  return time;
}
</script>
<script>
function empty2(id){
  inputs = document.getElementById(id).getElementsByTagName('input')
  for (i = 0; i < inputs.length; i++) {
    if(inputs[i].value=="" || inputs[i].value==undefined){
      alert("Oops! Empty Input.")
      return false
      break;
     }
   }
  return true;
}
</script>
<script>
var globPrivKey;

  var vidStream;
  function scan(){
    (function () {
      'use strict';

      var upload = document.getElementById('upload');
      var video = document.getElementById('video');
      var canvas = document.getElementById('canvas');
      navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then(function (stream) {
          video.srcObject = stream;
          vidStream = stream;
          video.muted = true;
          video.play();
        })
        .catch(function (err) {
          showResult(null, "An error occured! " + err);
        });
      var width = 320;    
      var height = 0;     

      var streamingStarted = false;
      video.addEventListener('canplay', function (ev) {
        if (!streamingStarted) {
          height = video.videoHeight / (video.videoWidth / width);
          video.setAttribute('width', width);
          video.setAttribute('height', height);
          canvas.setAttribute('width', width);
          canvas.setAttribute('height', height);
          streamingStarted = true;
        }
      }, false);
      var scanInterval = window.setInterval(scanCode, 500);
      function scanCode() {
        if (width && height) {
          var context = canvas.getContext('2d');
          canvas.width = width;
          canvas.height = height;
          context.drawImage(video, 0, 0, width, height);
          qr.decode(canvas.toDataURL('image/png'));
        }
      }

      var qr = new QrCode();
      qr.callback = showResult;
      var codeFound = false;
      function showResult(result, err) {
        if (codeFound) {
          return;
        }
        var span = document.querySelector('span') || document.createElement('span');
        if (result) {
          codeFound = true;
          video.pause();
          window.clearInterval(scanInterval);
          globPrivKey = result;
          alert("Authorization Successful");
        } else {
          return;
        }
      }
    })();}

function stopScan(){
video.pause();
video.src = "";
vidStream.getTracks()[0].stop();
}
  
var web3 = new Web3(new Web3.providers.HttpProvider("https://api.myetherapi.com/eth"));
var ensabi = JSON.parse('[ { "constant": true, "inputs": [ { "name": "node", "type": "bytes32" } ], "name": "resolver", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "node", "type": "bytes32" } ], "name": "owner", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "node", "type": "bytes32" }, { "name": "label", "type": "bytes32" }, { "name": "owner", "type": "address" } ], "name": "setSubnodeOwner", "outputs": [], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "node", "type": "bytes32" }, { "name": "ttl", "type": "uint64" } ], "name": "setTTL", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "node", "type": "bytes32" } ], "name": "ttl", "outputs": [ { "name": "", "type": "uint64" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "node", "type": "bytes32" }, { "name": "resolver", "type": "address" } ], "name": "setResolver", "outputs": [], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "node", "type": "bytes32" }, { "name": "owner", "type": "address" } ], "name": "setOwner", "outputs": [], "payable": false, "type": "function" }, { "inputs": [], "payable": false, "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "node", "type": "bytes32" }, { "indexed": true, "name": "label", "type": "bytes32" }, { "indexed": false, "name": "owner", "type": "address" } ], "name": "NewOwner", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "node", "type": "bytes32" }, { "indexed": false, "name": "owner", "type": "address" } ], "name": "Transfer", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "node", "type": "bytes32" }, { "indexed": false, "name": "resolver", "type": "address" } ], "name": "NewResolver", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "node", "type": "bytes32" }, { "indexed": false, "name": "ttl", "type": "uint64" } ], "name": "NewTTL", "type": "event" } ]');
    var resabi =  JSON.parse('[{"constant":true,"inputs":[{"name":"interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"node","type":"bytes32"},{"name":"contentTypes","type":"uint256"}],"name":"ABI","outputs":[{"name":"contentType","type":"uint256"},{"name":"data","type":"bytes"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"x","type":"bytes32"},{"name":"y","type":"bytes32"}],"name":"setPubkey","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"node","type":"bytes32"}],"name":"content","outputs":[{"name":"ret","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"node","type":"bytes32"}],"name":"addr","outputs":[{"name":"ret","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"contentType","type":"uint256"},{"name":"data","type":"bytes"}],"name":"setABI","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"node","type":"bytes32"}],"name":"name","outputs":[{"name":"ret","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"name","type":"string"}],"name":"setName","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"hash","type":"bytes32"}],"name":"setContent","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"node","type":"bytes32"}],"name":"pubkey","outputs":[{"name":"x","type":"bytes32"},{"name":"y","type":"bytes32"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"addr","type":"address"}],"name":"setAddr","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"ensAddr","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"node","type":"bytes32"},{"indexed":false,"name":"a","type":"address"}],"name":"AddrChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"node","type":"bytes32"},{"indexed":false,"name":"hash","type":"bytes32"}],"name":"ContentChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"node","type":"bytes32"},{"indexed":false,"name":"name","type":"string"}],"name":"NameChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"node","type":"bytes32"},{"indexed":true,"name":"contentType","type":"uint256"}],"name":"ABIChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"node","type":"bytes32"},{"indexed":false,"name":"x","type":"bytes32"},{"indexed":false,"name":"y","type":"bytes32"}],"name":"PubkeyChanged","type":"event"}]');
   var regabi = JSON.parse('[{"constant":false,"inputs":[{"name":"node","type":"bytes32"}],"name":"subRegistrationPeriod","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"}],"name":"nodeCheck","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"}],"name":"checkSubPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"},{"name":"price","type":"uint256"},{"name":"expiry","type":"uint256"}],"name":"listSubName","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"}],"name":"unlistSubName","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"node","type":"bytes32"}],"name":"checkSubAvailability","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"rootNode","type":"bytes32"},{"name":"subNode","type":"bytes32"},{"name":"newOwner","type":"address"}],"name":"subBuy","outputs":[],"payable":true,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"}]'); 

var myens = web3.eth.contract(ensabi).at("0x314159265dD8dbb310642f98f50C066173C1259b")
var myres = web3.eth.contract(resabi).at("0x1da022710dF5002339274AaDEe8D58218e9D6AB5")
var myreg = web3.eth.contract(regabi).at("0x753664c03482099F48320720BcC9b49D5da8a7A1")


function globalKeySub(){
  globPrivKey = $('#globPrivKey').val()
  alert("Authorization Successful")
}

function sendETH(){
  if(empty2("sendETH") == true){
    var from = $('#ETHfrom').val() 
    var to = $('#ETHto').val()     
    if(from.substr(0,2).toLowerCase() !="0x"){
      from = myres.addr.call(ens.getNameHash(from))
     }
    if(to.substr(0,2).toLowerCase() !="0x"){
      to = myres.addr.call(ens.getNameHash(to))  
     } 
    var key = globPrivKey 
    var amount =  toWei(parseFloat($('#ETHValue').val()))  
    var privkey = globalFuncs.myKeyBuffer(key)
    console.log(web3.eth.getTransactionCount(from))
    var rawTx = {
    from: from,
    nonce: web3.eth.getTransactionCount(from),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: to, 
    value: amount
  }
  eTx = new ethUtil.Tx(rawTx);
  eTx.sign(privkey);
  var serializedTx = eTx.serialize();
  web3.eth.sendRawTransaction("0x" + serializedTx.toString('hex'),function(err, txhash){
  if(err != undefined){alert(err);console.log(err)}else{alert('Transaction Succesful! \n Transaction Hash: ' + txhash);
  console.log("Transaction Succesful! Transaction hash: " + txhash);}});
 }  
}


function buy(){
  if(empty2("buyName") == true){
  var regName  = ens.getNameHash($('#regbuyername').val());
  if($('#regbuyername').val() == "root"){
    regName = ens.getNameHash("");
   }
  var buyer = $('#buyer').val()
  var ensName = web3.sha3($('#buyername').val())
  var key = globPrivKey
  var privkey = globalFuncs.myKeyBuffer(key)
  var price = toWei(parseFloat($('#buynameprice').val()))
  var mydata = myreg.subBuy.getData(regName,ensName,buyer)
  var rawTx = {
    from: buyer,
    nonce: web3.eth.getTransactionCount(buyer),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: myreg.address,
    value: price,
    data: mydata
    }
  eTx = new ethUtil.Tx(rawTx);
  eTx.sign(privkey);
  var serializedTx = eTx.serialize();
  web3.eth.sendRawTransaction("0x" + serializedTx.toString('hex'),function(err, txhash){
  if(err != undefined){alert(err);console.log(err)}else{alert('Sale Succesful! \n Transaction Hash: ' + txhash);
  console.log("Sale Succesful! Transaction hash: " + txhash);}});
  }
}



function sell(){
  if(empty2("sellName") == true){
  var ensName = ens.getNameHash($('#namesell').val())
  var seller = $('#seller').val()
  var expiry = parseInt($('#nameexpiry').val())
  var price = toWei(parseFloat($('#nameprice').val()))
  var key = globPrivKey
  var privkey = globalFuncs.myKeyBuffer(key)
  var mydata = myens.setOwner.getData(ensName,myreg.address)
  var rawTx = {
    from: seller,
    nonce: web3.eth.getTransactionCount(seller),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: myens.address, 
    data: mydata
  }
  eTx = new ethUtil.Tx(rawTx);
  eTx.sign(privkey);
  var serializedTx = eTx.serialize();
  console.log(serializedTx.toString('hex'))
  web3.eth.sendRawTransaction("0x" + serializedTx.toString('hex'),function(err, txhash){
  if(err != undefined){alert(err);console.log(err)}else{alert('Registrar Assignment Successful! \n Transaction Hash: ' + txhash);
   console.log("Reg tx hash: " + txhash);}});
  }
}


function list(){
  if(empty2("sellName") == true){
  var ensName = ens.getNameHash($('#namesell').val())
  var seller = $('#seller').val()
  var expiry = parseInt($('#nameexpiry').val())
  var price = toWei(parseFloat($('#nameprice').val()))
  var key = globPrivKey
  var privkey = globalFuncs.myKeyBuffer(key)
  var mydata2 = myreg.listSubName.getData(ensName,price,expiry)
  var rawTx2 = {
    from: seller,
    nonce: web3.eth.getTransactionCount(seller),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: myreg.address, 
    data: mydata2
  }
  eTx2 = new ethUtil.Tx(rawTx2);
  eTx2.sign(privkey);
  var serializedTx2 = eTx2.serialize();
  web3.eth.sendRawTransaction("0x" + serializedTx2.toString('hex'),function(err, txhash){
  if(err != undefined){alert(err);console.log(err)}else{alert('Listing Successful! \n Transaction Hash: ' + txhash);
  console.log("Listing tx hash: " + txhash);}});
  }
}

function unlist(){
  if(empty2("nameUnlist") == true){
  var ensName = ens.getNameHash($('#unlistEName').val())
  var origOwner = $('#origOwner').val()
  var key = globPrivKey
  var privkey = globalFuncs.myKeyBuffer(key)
  var mydata = myreg.unlistSubName.getData(ensName)
  var rawTx = {
    from: origOwner,
    nonce: web3.eth.getTransactionCount(origOwner),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: myreg.address, 
    data: mydata
  }
  eTx = new ethUtil.Tx(rawTx);
  eTx.sign(privkey);
  var serializedTx = eTx.serialize();
  web3.eth.sendRawTransaction("0x" + serializedTx.toString('hex'),function(err, txhash){
  if(err != undefined){alert(err);console.log(err)}else{alert('Unlisting Successful! \n Transaction Hash: ' + txhash);
  console.log("Unlisting tx hash: " + txhash);}});
  }  
 }

function check(){
    var data = ens.getNameHash($('#ename').val())
    if(myens.owner(data) == "0x0000000000000000000000000000000000000000"){
      $("span.owner").html("No Owner");
      $("span.subPrice").text("None");
      $("span.subexpiry").html("None");
      $("span.subavailability").text("No");
    }
    else{
      $("span.owner").html(myens.owner(data));
      $("span.subexpiry").html( parseInt(parseInt(myreg.subRegistrationPeriod.call(data).toString())/2592000).toString() + " months" );
      sprice = myreg.checkSubPrice.call(data)
      $("span.subPrice").text(sprice/1.0e18 + " ETH");
      sval = myreg.checkSubAvailability.call(data);
      $("span.subavailability").text(sval);
    }
      console.log(regabi);
 }

function resolve(){
  if(empty2("resolveName") == true){
    var from = $('#origETH').val()
    var dest = $('#destETH').val()
    var ensName = ens.getNameHash($('#resENS').val())
    var key = globPrivKey
    var privkey = globalFuncs.myKeyBuffer(key)
    var mydata = myres.setAddr.getData(ensName,dest)
    var rawTx = {
    from: from,
    nonce: web3.eth.getTransactionCount(from),
    gasLimit: 50000,
    gasPrice: 21000000000,
    to: myres.address,  
    data: mydata
      }
    eTx = new ethUtil.Tx(rawTx);
    eTx.sign(privkey);
    var serializedTx = eTx.serialize();
    web3.eth.sendRawTransaction("0x" + serializedTx.toString('hex'),function(err, txhash){
    if(err != undefined){alert(err);console.log(err)}else{alert('Resolution Successful! \n Transaction Hash: ' + txhash);
    console.log("Transaction hash: " + txhash);}});
 }
}

function resCheck(){
    var data = ens.getNameHash($('#resCheckName').val())
    $("span.resPoint").text(myres.addr.call(data));
 }

</script>
</body>
</html>
